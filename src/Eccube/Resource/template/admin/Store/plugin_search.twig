{#
This file is part of EC-CUBE

Copyright(c) LOCKON CO.,LTD. All Rights Reserved.

http://www.lockon.co.jp/

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
#}

{% extends 'default_frame.twig' %}

{% set menus = ['store', 'plugin', 'plugin_search'] %}

{% block title %}{{'admin.store.plugin_search.884'|trans}}{% endblock %}
{% block sub_title %}{{'admin.store.plugin_search.885'|trans}}{% endblock %}

{% block javascript %}
    <script src="{{ asset('assets/js/vendor/masonry.pkgd.min.js', 'admin') }}"></script>
    <script>
        $(function() {
            $('.grid').masonry({
                itemSelector: '.grid-item',
                columnWidth: '.grid-item'
            });

            $('a.searchPluginModal').on('click', function (e) {
                e.preventDefault();
                var obj = $(this);
                var id = obj.attr('data-id');
                $.ajax({
                    type: 'GET',
                    dataType: 'jsonp',
                    crossDomain: true,
                    url: '{{ app.config.package_repo_url }}/detail/' + id,
                    success: function (data) {
                        showPopup(obj, data, id);
                    },
                    error: function () {
                        alert('Plugin not found !');
                    }
                });
            });

            function showPopup(obj, data, id) {
                var modal_plugin = $('#searchPluginModal');
                var btn_html = obj.closest('div').find('#plugin-id-' + id).get(0).outerHTML;
                $('#search_plugin_modal_box__body', modal_plugin).html(data);
                $('#search_plugin_modal_box__buttons', modal_plugin).html(btn_html);
                modal_plugin.modal('show');
            }
        });

    </script>
{% endblock javascript %}

{% block stylesheet %}
    <style type="text/css">
        .display-in-bl {
            display: inline-block;
        }
    </style>
{% endblock stylesheet %}

{% block main %}
    <div class="row">
        <div class="col-md-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">{{'admin.store.plugin_search.886'|trans}}</h3>
                </div><!-- /.box-header -->
                <div class="box-body">
                    <div class="row">
                        <div class="col-xs-12">
                            {% if items|length > 0%}
                                <div class="plugin-block">
                                    <div class="row">
                                        {% for item in promotionItems %}
                                            <div class="col-xs-12">
                                                {{ include('Store/plugin_search_panel.twig') }}
                                            </div>
                                        {% endfor %}
                                    </div><!-- .row -->
                                    <div class="row grid">
                                        {% for item in items %}
                                            <div class="col-xs-12 grid-item">
                                                {{ include('Store/plugin_search_panel.twig') }}
                                            </div>
                                        {% endfor %}
                                    </div><!-- .row -->
                                </div><!-- .plugin-block -->
                            {% else %}
                                <p class="text-danger">{{ message }}</p>
                            {% endif %}
                        </div><!-- .col-xs-12 -->
                    </div><!-- .row -->
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </div><!-- /.col -->
    </div>
{% endblock %}

{% block modal %}
    <div class="modal fade" id="searchPluginModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div id="search_plugin_modal_box" class="modal-content">
                <div id="search_plugin_modal_box__header" class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="modal-close" aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">&nbsp;</h4>
                </div>
                <div id="search_plugin_modal_box__body" class="modal-body" style="background: #fff"></div>
                <div id="search_plugin_modal_box__buttons" class="modal-footer" style="background: #fff"></div>
            </div>
        </div>
    </div>
{% endblock %}
